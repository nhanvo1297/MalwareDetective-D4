console.log("Hello World");
console.log("Hello World");
const uploadForm = document.getElementById("upload-form");
const input = document.getElementById("id_image");

console.log(input);

const alertBox = document.getElementById("alert-box");

const imageBox = document.getElementById("image-box");

const progressBox = document.getElementById("progress-box");
const cancelBox = document.getElementById("cancel-box");
const cancelBtn = document.getElementById("cancel-btn");
const scanBox = document.getElementById("scan-box");
const scanBtn = document.getElementById("scan-btn");
const csrf = document.getElementsByName("csrfmiddlewaretoken");

input.addEventListener("change", () => {
  progressBox.classList.remove("not-visible");
  cancelBox.classList.remove("not-visible");
  scanBox.classList.remove("not-visible");
  const img_data = input.files[0];
  const url = URL.createObjectURL(img_data);
  console.log(img_data);

  const fd = new FormData();
  fd.append("csrfmiddlewaretoken", csrf[0].value);
  fd.append("image", img_data);
  $.ajax({
    type: "POST",
    url: uploadForm.action,
    enctype: "multiplart/form-data",
    data: fd,
    beforeSend: function () {},
    xhr: function () {
      const xhr = new window.XMLHttpRequest();
      xhr.upload.addEventListener("progress", (e) => {
        // console.log(e);
        if (e.lengthComputable) {
          const percent = (e.loaded / e.total) * 100;
          console.log(percent);
          progressBox.innerHTML = `<div class="progress">
          <div class="progress-bar" role="progressbar" style="width: ${percent}%" aria-valuenow="${percent}" aria-valuemin="0" aria-valuemax="100"></div>
        </div><p>${percent.toFixed(1)}</p>`;
        }
      });
      cancelBtn.addEventListener("click", () => {
        xhr.abort();
        progressBox.innerHTML = "";
        cancelBox.classList.add("not-visible");
      });

      // Need to work on this scan function *******
      // scanBtn.addEventListener("click", () => {
      //   xhr.abort();
      //   progressBox.innerHTML = "";
      //   scanBox.classList.add("not-visible");
      // });
      return xhr;
    },
    success: function (response) {
      console.log(response);
    },
    error: function (error) {
      console.log(error);
    },
    cache: false,
    contentType: false,
    processData: false,
  });
});

function openPage(pageName, elmnt, color) {
  // Hide all elements with class="tabcontent" by default */
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  // Remove the background color of all tablinks/buttons
  tablinks = document.getElementsByClassName("tablink");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].style.backgroundColor = "";
  }

  // Show the specific tab content
  document.getElementById(pageName).style.display = "block";

  // Add the specific color to the button used to open the tab content
  elmnt.style.backgroundColor = color;
}

// Get the element with id="defaultOpen" and click on it
document.getElementById("defaultOpen").click();
